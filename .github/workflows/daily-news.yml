name: Daily Hindi News Fetcher

on:
  schedule:
    - cron: '0 7 * * *'
  workflow_dispatch:

jobs:
  fetch-news:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ðŸ” Debug - List files
      run: |
        echo "=== Current Directory ==="
        pwd
        echo "=== Files in Repository ==="
        ls -la
        echo "=== All Files Recursive ==="
        find . -type f -name "*.js" | head -20

    - name: âš™ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: ðŸ“¦ Install Puppeteer
      run: |
        npm install puppeteer@latest --no-package-lock

    - name: ðŸ” Verify script exists
      run: |
        echo "Checking for news-script.js..."
        if [ -f "news-script.js" ]; then
          echo "âœ… news-script.js found!"
          echo "=== File content first 10 lines ==="
          head -10 news-script.js
        else
          echo "âŒ news-script.js NOT found!"
          echo "=== Creating basic script ==="
          cat > news-script.js << 'EOF'
          const fs = require('fs');
          console.log('ðŸš€ Test script running!');
          fs.writeFileSync('test-output.json', JSON.stringify({test: "success", timestamp: new Date().toISOString()}, null, 2));
          console.log('âœ… Test file created!');
          EOF
        fi

    - name: ðŸš€ Run news script
      run: node news-script.js
      timeout-minutes: 10

    - name: ðŸ“¤ Upload results
      uses: actions/upload-artifact@v4
      with:
        name: news-results
        path: |
          *.json
          *.txt
          *.png
        retention-days: 7